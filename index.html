<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        * {
        margin: 0;
        padding: 0;
        }

        html, body {
        max-width: 100vw;
        }

        .container-fluid {
        width: 100vw;
        min-height: 100vh;
        max-width: 100vw;
        padding: 2rem 0;
        }

        .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        }

        .row {
        width: 100%;
        padding: 0;
        margin: 0;
        }

        .quote-calculation {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2rem;
        }

        .small-column, .medium-column {
        height: 50vh;
        max-height: 400px;
        }

        .small-column {
        width: 20%;
        }

        .medium-column {
        width: 28%;
        }

        .rooms-list-area, .calculation-area, .items-area, .item-type-area {
        border: 1px solid gray;
        }

        .item-type-area {
        overflow: auto;
        }

        .room-list, .item-type {
        list-style: none;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        }

        .room-list li, .item-type li {
        width: 100%;
        }

        .room-list a, .room-list a:visited, .item-type a, .item-type a:visited {
        display: block;
        text-decoration: none;
        padding: 1rem;
        color: black;
        border-bottom: 1px solid grey;
        }

        .room-list a:hover, .item-type a:hover {
        background-color: lightgrey;
        color: white;
        }

        .link-active {
        background-color: lightgreen;
        box-shadow: 1px 1px 10px grey inset;
        }

        .calculation-area, .items-area {
        overflow-y: scroll;
        }

        .calculation-items, .moving-items {
        height: 100%;
        width: 100%;
        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        flex-wrap: wrap;
        }

        .calculation-item, .moving-item {
        padding: 1rem;
        margin: 1rem;
        border: 1px solid black;
        }

        .qtyBadge {
        padding: 2px 8px;
        border-radius: 50%;
        background-color: lightblue;
        color: white;
        }
    </style>
</head>
<body>
    <div id="root">
        <weight-calculator></weight-calculator>
    </div>


    <!-- production version, optimized for size and speed -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->

    <!-- development version, includes helpful console warnings -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>
    <!-- CDNJS :: Vue.Draggable (https://cdnjs.com/) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.20.0/vuedraggable.umd.min.js"></script>

    <script>
        Vue.component('WeightCalculator', {
            template:`
            <div class="container-fluid">
                <div class="container">
                <div class="row quote-calculation">
                    <div class="small-column rooms-list-area">
                    <ul class="room-list">
                        <li v-for="(room, index) in rooms" :key="index"><a href="#" @click="activateRoom(room)"  :class="activeRoom === room ?'link-active':''">{{ room }}</a></li>
                    </ul>
                    </div>

                    <div class="medium-column calculation-area">
                    <h3>Calculation Area</h3>
                    <draggable
                        class="dragArea calculation-items"
                        :list="calculationList"
                        group="movable-items"
                        @change="cloned"
                    >
                        <div
                            class="calculation-item"
                            v-for="(element, index) in itemsInActiveRoom()"
                            :key="index"
                        >
                        {{ element.name }}
                        <span v-show="element.qty > 1" class="qtyBadge">{{ element.qty }}</span>
                        </div>
                    </draggable>
                    </div>

                    <div class="medium-column items-area">
                    <h3>Moving Items Area</h3>
                    <draggable
                        class="dragArea moving-items"
                        :list="movingList"
                        :group="{ name: 'movable-items', pull: 'clone', put: false }"
                        @change="moved"
                    >
                        <div
                            class="moving-item"
                            v-for="(element, index) in movingList"
                            :key="index"
                        >
                        {{ element.name }}
                        </div>
                    </draggable>
                    </div>

                    <div class="small-column item-type-area">
                    <ul class="item-type">
                        <li v-for="(category, index) in itemCategories" :key="index"><a href="#" @click="activateCategory(category)" :class="activeItemCategory === category ? 'link-active':''">{{ category }}</a></li>
                    </ul>
                    </div>
                </div>

                <div class="row">
                    <p>Total Weight: <strong>{{ getTotalCalculatedWeight }}</strong> lbs; Total Sqft: <strong>{{ getTotalSqft }}</strong></p>
                </div>
                </div>
            </div>
            `,
            display: "Clone",
            order: 2,
            computed:{
                rooms(){
                if(this.movingRoomNo === 1){
                    return ['Master Bed', 'Kitchen', 'Living Space']
                }else {
                    return ['Master Bed', 'Kitchen']
                }
                },

                movingListString() {
                return JSON.stringify(this.movingList, null, 2);
                },

                calculationListString() {
                return JSON.stringify(this.calculationList, null, 2);
                },

                getTotalCalculatedWeight() {
                let totalWeight = 0
                for(let item of this.calculationList){
                    totalWeight += item.weight
                }
                return totalWeight
                },

                getTotalSqft(){
                let totalSqft = 0
                for(let item of this.calculationList){
                    totalSqft += item.area
                }
                return totalSqft
                },
            },
            data() {
                return {
                movingList: [
                    {name:'chair', weight: 20, area: 4, itemType:'Accessories', qty:1},
                    {name:'table', weight: 40, area: 8, itemType:'Accessories', qty:1},
                    {name:'bed', weight: 40, area: 35, itemType:'Accessories', qty:1},
                    {name:'dresser', weight: 30, area: 4.5, itemType:'Accessories', qty:1},
                    {name:'fridge', weight: 20, area: 4, itemType:'Accessories', qty:1}
                ],
                movingRoomNo: null,
                activeRoom: 'Master Bed',
                activeItemCategory: 'Accessories',
                itemCategories: ['Accessories', 'Boxes', 'Beds', 'Appliances', 'Electronics', 'Outdoor', 'Home Storage Unit', 'Miscellaneous', 'Sports', 'Soft Furniture & Carpets', 'Tables & Chairs'],
                calculationList: [],
                modCalculationList: [],
                allItemsCalculation: {},
                // editable: true,
                // isDragging: false,
                // delayedDragging: false
                };
            },

            mounted() {
                if(!(this.activeRoom in this.allItemsCalculation)){
                this.allItemsCalculation[this.activeRoom.trim().replace(' ', '_').toLowerCase()] = []
                console.log(this.allItemsCalculation)
                }
            },

            methods: {
                cloned(evt) {
                if(this.calculationList.length > 1){
                    let duplicateItems = this.calculationList.filter(item => item.name === evt.added.element.name)
                    if(duplicateItems.length > 1){
                    const uniqueItem = this.calculationList.find(item => item.name === evt.added.element.name)
                    uniqueItem.qty = duplicateItems.length

                    const oldUniqueItem = this.allItemsCalculation[this.activeRoom.trim().replace(' ', '_').toLowerCase()].find(item => item.name === evt.added.element.name)
                    if(oldUniqueItem){
                        this.allItemsCalculation[this.activeRoom.trim().replace(' ', '_').toLowerCase()].splice(this.modCalculationList.indexOf(oldUniqueItem), 1, uniqueItem)
                    }else{
                        this.allItemsCalculation[this.activeRoom.trim().replace(' ', '_').toLowerCase()].push(uniqueItem)
                    }
                    }else{
                    this.allItemsCalculation[this.activeRoom.trim().replace(' ', '_').toLowerCase()].push(evt.added.element)
                    }
                }else{
                    this.allItemsCalculation[this.activeRoom.trim().replace(' ', '_').toLowerCase()].push(evt.added.element)
                }

                if(this.activeRoom.trim().replace(' ', '_').toLowerCase() in this.allItemsCalculation) {
                    this.allItemsCalculation[this.activeRoom.trim().replace(' ', '_').toLowerCase()] = this.modCalculationList
                }
                console.log(this.calculationList)
                console.log(this.allItemsCalculation)
                },

                moved(evt){
                console.log(evt)
                },

                activateRoom(room){
                this.activeRoom = room
                if(!(room in this.allItemsCalculation)){
                    this.allItemsCalculation[room.trim().replace(' ', '_').toLowerCase()] = []
                }

                console.log(this.allItemsCalculation)
                },

                activateCategory(category){
                this.activeItemCategory = category
                this.filterItems(category)
                },

                filterItems(category){
                const filteredMovingList = this.movingList.filter(item=>item.itemType===category)
                console.log(filteredMovingList)
                },

                itemQuantity(itemName){
                let multipleEntry = this.calculationList.filter(item => item.name === itemName)
                return multipleEntry.length
                },

                itemsInActiveRoom(){
                return this.allItemsCalculation[this.activeRoom.trim().replace(' ', '_').toLowerCase()]
                }
            },
        })
        new Vue({
            el: '#root',
            components: {
                draggable: window['vuedraggable']
            },
        });
    </script>
</body>
</html>