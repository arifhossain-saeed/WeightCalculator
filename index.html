<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            }

            html, body {
            max-width: 100vw;
            }
            .flip-list-move {
            transition: transform 0.5s;
            }

            .no-move {
            transition: transform 0s;
            }

            .ghost {
            opacity: 0.5;
            background: #c8ebfb;
            }

            .container-fluid {
            width: 100vw;
            min-height: 100vh;
            max-width: 100vw;
            padding: 2rem 0;
            }

            .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            }

            .row {
            width: 100%;
            padding: 0;
            margin: 0;
            }

            .quote-calculation {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            }

            .small-column, .medium-column {
            height: 50vh;
            max-height: 400px;
            }

            .small-column {
            width: 20%;
            }

            .medium-column {
            width: 28%;
            }

            .rooms-list-area, .calculation-area, .items-area, .item-type-area {
            border: 1px solid gray;
            }

            .item-type-area {
            overflow: auto;
            }

            .room-list, .item-type {
            list-style: none;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            }

            .room-list li, .item-type li {
            width: 100%;
            }

            .room-list a, .room-list a:visited, .item-type a, .item-type a:visited {
            display: block;
            text-decoration: none;
            padding: 1rem;
            color: black;
            border-bottom: 1px solid grey;
            }

            .room-list a:hover, .item-type a:hover {
            background-color: lightgrey;
            color: white;
            }

            .link-active {
            background-color: lightgreen;
            box-shadow: 1px 1px 10px grey inset;
            }

            .calculation-items, .moving-items span {
            height: 100%;
            width: 100%;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            flex-wrap: wrap;
            }

            .moving-items {
            width: 100%;
            height: 100%;
            }

            .calculation-item, .moving-item {
            padding: 1rem;
            margin: 1rem;
            border: 1px solid black;
            }
    </style>
</head>
<body>
    <div id="root">
        <weight-calculator></weight-calculator>
    </div>


    <!-- production version, optimized for size and speed -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->

    <!-- development version, includes helpful console warnings -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>
    <!-- CDNJS :: Vue.Draggable (https://cdnjs.com/) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.20.0/vuedraggable.umd.min.js"></script>

    <script>
        Vue.component('WeightCalculator', {
            template:`
            <div class="container-fluid">
                <div class="container">
                <div class="row quote-calculation">
                    <div class="small-column rooms-list-area">
                    <ul class="room-list">
                        <li v-for="(room, index) in rooms" :key="index"><a href="#" @click="activateRoom(room)"  :class="activeRoom === room ?'link-active':''">{{ room }}</a></li>
                    </ul>
                    </div>

                    <div class="medium-column calculation-area">
                    <draggable element="span" v-model="calculationList" v-bind="dragOptions" :move="onMove">
                        <transition-group name="no" class="calculation-items" tag="div">
                        <div class="calculation-item" v-for="(element, index) in calculationList" :key="index">
                            {{element.name}}
                            <span class="badge">{{ itemQuantity(element.name) }}</span>
                        </div>
                        </transition-group>
                    </draggable>
                    </div>

                    <div class="medium-column items-area">
                    <draggable class="moving-items" tag="div" v-model="movingList" v-bind="dragOptions" :move="onMove" @start="isDragging=true" @end="isDragging=false">
                        <transition-group type="transition" :name="'flip-list'">
                        <div class="moving-item" v-for="(element, index) in movingList" :key="index">
                            {{element.name}}
                            <span class="badge">{{element.weight}} lbs</span>
                        </div>
                        </transition-group>
                    </draggable>
                    </div>

                    <div class="small-column item-type-area">
                    <ul class="item-type">
                        <li v-for="(category, index) in itemCategories" :key="index"><a href="#" @click="activateCategory(category)" :class="activeItemCategory === category ? 'link-active':''">{{ category }}</a></li>
                    </ul>
                    </div>
                </div>

                <div class="row">
                    <p>Total Weight: <strong>{{ getTotalCalculatedWeight }}</strong> lbs; Total Sqft: <strong>{{ getTotalSqft }}</strong></p>
                </div>
                </div>
            </div>
            `,

            data() {
                return {
                movingList: [
                    {name:'chair', weight: 20, area: 4, itemType:'Accessories'},
                    {name:'table', weight: 40, area: 8, itemType:'Accessories'},
                    {name:'bed', weight: 40, area: 35, itemType:'Accessories'},
                    {name:'dresser', weight: 30, area: 4.5, itemType:'Accessories'},
                    {name:'fridge', weight: 20, area: 4, itemType:'Accessories'}
                ],
                movingRoomNo: null,
                activeRoom: 'Master Bed',
                activeItemCategory: 'Accessories',
                itemCategories: ['Accessories', 'Boxes', 'Beds', 'Appliances', 'Electronics', 'Outdoor', 'Home Storage Unit', 'Miscellaneous', 'Sports', 'Soft Furniture & Carpets', 'Tables & Chairs'],
                calculationList: [],
                editable: true,
                isDragging: false,
                delayedDragging: false
                };
            },
            methods: {
                // orderList() {
                //   this.movingList = this.movingList.sort((one, two) => {
                //     return one.order - two.order;
                //   });
                // },
                onMove({ relatedContext, draggedContext }) {
                const relatedElement = relatedContext.element;
                const draggedElement = draggedContext.element;
                return (
                    (!relatedElement || !relatedElement.fixed) && !draggedElement.fixed
                );
                },

                activateRoom(room){
                this.activeRoom = room
                },

                activateCategory(category){
                this.activeItemCategory = category
                this.filterItems(category)
                },

                filterItems(category){
                const filteredMovingList = this.movingList.filter(item=>item.itemType===category)
                console.log(filteredMovingList)
                },

                itemQuantity(itemName){
                let multipleEntry = this.calculationList.filter(item => item.name === itemName)
                return multipleEntry.length
                }
            },
            computed: {
                dragOptions() {
                return {
                    animation: 0,
                    group: "description",
                    disabled: !this.editable,
                    ghostClass: "ghost"
                };
                },
                rooms(){
                if(this.movingRoomNo === 1){
                    return ['Master Bed', 'Kitchen', 'Living Space']
                }else {
                    return ['Master Bed', 'Kitchen']
                }
                },
                movingListString() {
                return JSON.stringify(this.movingList, null, 2);
                },
                calculationListString() {
                return JSON.stringify(this.calculationList, null, 2);
                },

                getTotalCalculatedWeight() {
                let totalWeight = 0
                for(let item of this.calculationList){
                    totalWeight += item.weight
                }
                return totalWeight
                },

                getTotalSqft(){
                let totalSqft = 0
                for(let item of this.calculationList){
                    totalSqft += item.area
                }
                return totalSqft
                },

                // itemQuantity(itemName){
                //   let filteredItems = 0
                //   if(this.calculationList.length > 1){
                //     filteredItems = this.calculationList.filter(item => item.name === itemName)
                //   }
                //
                //   return filteredItems.length > 1 ? filteredItems.length : 1;
                // }
            },
            watch: {
                isDragging(newValue) {
                if (newValue) {
                    this.delayedDragging = true;
                    return;
                }
                this.$nextTick(() => {
                    this.delayedDragging = false;
                });
                }
            }
        })
        new Vue({
            el: '#root',
            components: {
                draggable: window['vuedraggable']
            },
        });
    </script>
</body>
</html>